---
interface Service {
  id: string;
  title: string;
  shortTitle: string;
  description: string[];
  projectTypes: string[];
  icon: string;
  image?: string;
}

interface Props {
  services: Service[];
}

const { services } = Astro.props;

// Local service images mapped to icon types
const serviceImages: Record<string, { webp: string; png: string }> = {
  renovation: { webp: '/images/Services/one.webp', png: '/images/Services/one.png' },
  kitchen: { webp: '/images/Services/two.webp', png: '/images/Services/two.png' },
  brick: { webp: '/images/Services/three.webp', png: '/images/Services/three.png' },
  exterior: { webp: '/images/Services/four.webp', png: '/images/Services/four.png' },
  foundation: { webp: '/images/Services/five.webp', png: '/images/Services/five.png' },
  epoxy: { webp: '/images/Services/six.webp', png: '/images/Services/six.png' },
  construction: { webp: '/images/Services/seven.webp', png: '/images/Services/seven.png' },
  maintenance: { webp: '/images/Services/eight.webp', png: '/images/Services/eight.png' },
};

const getServiceImagePaths = (service: Service) => {
  if (service.image) {
    const pngPath = service.image.replace('.webp', '.png');
    return { webp: service.image, png: pngPath };
  }
  return serviceImages[service.icon] || serviceImages.renovation;
};
---

<!-- Desktop: Vertical tabs on left, content on right -->
<div class="hidden lg:grid lg:grid-cols-[300px_1fr] gap-8 items-start">
  <!-- Vertical Tab Navigation -->
  <nav class="sticky top-24 bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden" role="tablist" aria-label="Services navigation">
    {services.map((service, index) => (
      <button
        role="tab"
        id={`tab-${service.id}`}
        aria-selected={index === 0 ? "true" : "false"}
        aria-controls={`panel-${service.id}`}
        data-service-tab={service.id}
        class={`service-tab w-full text-left px-5 py-4 border-l-4 transition-all duration-200 flex items-center gap-3 ${index === 0 ? 'bg-[var(--light-gray)] border-l-[var(--secondary)] text-[var(--primary)] font-semibold' : 'border-l-transparent text-gray-600 hover:bg-gray-50 hover:text-[var(--charcoal)]'} ${index < services.length - 1 ? 'border-b border-gray-100' : ''}`}
      >
        <span class="text-sm">{service.shortTitle}</span>
      </button>
    ))}
  </nav>

  <!-- Content Panels -->
  <div class="service-panels">
    {services.map((service, index) => (
      <div
        role="tabpanel"
        id={`panel-${service.id}`}
        aria-labelledby={`tab-${service.id}`}
        data-service-panel={service.id}
        class={`service-panel ${index === 0 ? '' : 'hidden'}`}
      >
        <!-- Service Image -->
        <div class="aspect-video md:aspect-[16/9] rounded-xl overflow-hidden mb-8 shadow-lg service-image-container">
          <picture>
            <source srcset={getServiceImagePaths(service).webp} type="image/webp" />
            <img
              src={getServiceImagePaths(service).png}
              alt={service.title}
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
              loading={index === 0 ? "eager" : "lazy"}
            />
          </picture>
        </div>

        <!-- Service Content -->
        <div>
          <h2 class="text-[var(--charcoal)] mb-4 section-title">{service.title}</h2>

          <div class="space-y-4 mb-6">
            {service.description.map((paragraph) => (
              <p class="text-gray-600">{paragraph}</p>
            ))}
          </div>

          <div class="mb-8">
            <h3 class="text-lg font-bold text-[var(--charcoal)] mb-3">Common Project Types:</h3>
            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              {service.projectTypes.map((type) => (
                <li class="flex items-start gap-2">
                  <svg class="w-5 h-5 text-[var(--accent-gold)] flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm text-gray-600">{type}</span>
                </li>
              ))}
            </ul>
          </div>

          <div class="flex flex-col sm:flex-row gap-3">
            <a href="/contact" class="btn btn-primary">
              Request a Quote
            </a>
            <a href="tel:+16316059851" class="btn bg-[var(--light-gray)] text-[var(--charcoal)] hover:bg-[var(--medium-gray)]">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              Call Us
            </a>
          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<!-- Tablet: Horizontal scrollable tabs -->
<div class="hidden md:block lg:hidden">
  <!-- Horizontal Tab Bar -->
  <nav class="sticky top-20 bg-white z-10 -mx-4 px-4 py-3 border-b border-gray-200 mb-8" role="tablist" aria-label="Services navigation">
    <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
      {services.map((service, index) => (
        <button
          role="tab"
          id={`tab-md-${service.id}`}
          aria-selected={index === 0 ? "true" : "false"}
          aria-controls={`panel-md-${service.id}`}
          data-service-tab-md={service.id}
          class={`service-tab-md whitespace-nowrap px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex-shrink-0 ${index === 0 ? 'bg-[var(--primary)] text-white shadow-md' : 'bg-[var(--light-gray)] text-gray-600 hover:bg-[var(--medium-gray)] hover:text-[var(--charcoal)]'}`}
        >
          {service.shortTitle}
        </button>
      ))}
    </div>
  </nav>

  <!-- Content Panels -->
  <div class="service-panels-md">
    {services.map((service, index) => (
      <div
        role="tabpanel"
        id={`panel-md-${service.id}`}
        aria-labelledby={`tab-md-${service.id}`}
        data-service-panel-md={service.id}
        class={`service-panel-md ${index === 0 ? '' : 'hidden'}`}
      >
        <!-- Service Image -->
        <div class="aspect-video rounded-xl overflow-hidden mb-6 shadow-lg service-image-container">
          <picture>
            <source srcset={getServiceImagePaths(service).webp} type="image/webp" />
            <img
              src={getServiceImagePaths(service).png}
              alt={service.title}
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
              loading={index === 0 ? "eager" : "lazy"}
            />
          </picture>
        </div>

        <!-- Service Content -->
        <div>
          <h2 class="text-[var(--charcoal)] mb-4 section-title">{service.title}</h2>

          <div class="space-y-4 mb-6">
            {service.description.map((paragraph) => (
              <p class="text-gray-600">{paragraph}</p>
            ))}
          </div>

          <div class="mb-6">
            <h3 class="text-lg font-bold text-[var(--charcoal)] mb-3">Common Project Types:</h3>
            <ul class="grid grid-cols-2 gap-2">
              {service.projectTypes.map((type) => (
                <li class="flex items-start gap-2">
                  <svg class="w-5 h-5 text-[var(--accent-gold)] flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm text-gray-600">{type}</span>
                </li>
              ))}
            </ul>
          </div>

          <div class="flex flex-col sm:flex-row gap-3">
            <a href="/contact" class="btn btn-primary">
              Request a Quote
            </a>
            <a href="tel:+16316059851" class="btn bg-[var(--light-gray)] text-[var(--charcoal)] hover:bg-[var(--medium-gray)]">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
              Call Us
            </a>
          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<!-- Mobile: Accordion -->
<div class="md:hidden space-y-3">
  {services.map((service, index) => (
    <details
      id={`accordion-${service.id}`}
      class="service-accordion group bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden"
      open={index === 0}
    >
      <summary class="flex items-center justify-between p-4 cursor-pointer select-none hover:bg-gray-50 transition-colors">
        <span class="font-bold text-[var(--charcoal)]">{service.shortTitle}</span>
        <svg class="w-5 h-5 text-gray-500 transform transition-transform duration-200 group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </summary>

      <div class="px-4 pb-4 border-t border-gray-100">
        <!-- Service Image -->
        <div class="aspect-video rounded-lg overflow-hidden my-4 shadow service-image-container">
          <picture>
            <source srcset={getServiceImagePaths(service).webp} type="image/webp" />
            <img
              src={getServiceImagePaths(service).png}
              alt={service.title}
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </picture>
        </div>

        <!-- Service Content -->
        <h3 class="text-lg font-bold text-[var(--charcoal)] mb-3">{service.title}</h3>

        <div class="space-y-3 mb-4">
          {service.description.map((paragraph) => (
            <p class="text-sm text-gray-600">{paragraph}</p>
          ))}
        </div>

        <div class="mb-4">
          <h4 class="text-sm font-bold text-[var(--charcoal)] mb-2">Project Types:</h4>
          <ul class="space-y-1">
            {service.projectTypes.map((type) => (
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-[var(--accent-gold)] flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                <span class="text-xs text-gray-600">{type}</span>
              </li>
            ))}
          </ul>
        </div>

        <div class="flex flex-col gap-2">
          <a href="/contact" class="btn btn-primary text-sm py-2">
            Request a Quote
          </a>
          <a href="tel:+16316059851" class="btn bg-[var(--light-gray)] text-[var(--charcoal)] hover:bg-[var(--medium-gray)] text-sm py-2">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            Call Us
          </a>
        </div>
      </div>
    </details>
  ))}
</div>

<script>
  // Desktop tab switching
  document.querySelectorAll('[data-service-tab]').forEach(tab => {
    tab.addEventListener('click', () => {
      const serviceId = tab.getAttribute('data-service-tab');

      // Update tab states
      document.querySelectorAll('[data-service-tab]').forEach(t => {
        const isActive = t.getAttribute('data-service-tab') === serviceId;
        t.setAttribute('aria-selected', isActive ? 'true' : 'false');
        t.classList.toggle('bg-[var(--light-gray)]', isActive);
        t.classList.toggle('border-l-[var(--secondary)]', isActive);
        t.classList.toggle('text-[var(--primary)]', isActive);
        t.classList.toggle('font-semibold', isActive);
        t.classList.toggle('border-l-transparent', !isActive);
        t.classList.toggle('text-gray-600', !isActive);
      });

      // Update panel visibility
      document.querySelectorAll('[data-service-panel]').forEach(panel => {
        const isActive = panel.getAttribute('data-service-panel') === serviceId;
        panel.classList.toggle('hidden', !isActive);
      });

      // Update URL hash
      window.history.replaceState(null, '', `#${serviceId}`);
    });
  });

  // Tablet tab switching
  document.querySelectorAll('[data-service-tab-md]').forEach(tab => {
    tab.addEventListener('click', () => {
      const serviceId = tab.getAttribute('data-service-tab-md');

      // Update tab states
      document.querySelectorAll('[data-service-tab-md]').forEach(t => {
        const isActive = t.getAttribute('data-service-tab-md') === serviceId;
        t.setAttribute('aria-selected', isActive ? 'true' : 'false');
        t.classList.toggle('bg-[var(--primary)]', isActive);
        t.classList.toggle('text-white', isActive);
        t.classList.toggle('shadow-md', isActive);
        t.classList.toggle('bg-[var(--light-gray)]', !isActive);
        t.classList.toggle('text-gray-600', !isActive);
      });

      // Update panel visibility
      document.querySelectorAll('[data-service-panel-md]').forEach(panel => {
        const isActive = panel.getAttribute('data-service-panel-md') === serviceId;
        panel.classList.toggle('hidden', !isActive);
      });

      // Update URL hash
      window.history.replaceState(null, '', `#${serviceId}`);
    });
  });

  // Handle URL hash on page load
  const handleHashNavigation = () => {
    const hash = window.location.hash.slice(1);
    if (hash) {
      // Desktop
      const desktopTab = document.querySelector(`[data-service-tab="${hash}"]`) as HTMLButtonElement;
      if (desktopTab) desktopTab.click();

      // Tablet
      const tabletTab = document.querySelector(`[data-service-tab-md="${hash}"]`) as HTMLButtonElement;
      if (tabletTab) tabletTab.click();

      // Mobile accordion
      const accordion = document.getElementById(`accordion-${hash}`) as HTMLDetailsElement;
      if (accordion) {
        // Close all others first
        document.querySelectorAll('.service-accordion').forEach(a => {
          if (a.id !== `accordion-${hash}`) {
            (a as HTMLDetailsElement).open = false;
          }
        });
        accordion.open = true;
        accordion.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
  };

  // Run on load
  handleHashNavigation();

  // Listen for hash changes
  window.addEventListener('hashchange', handleHashNavigation);
</script>

<style>
  /* Hide scrollbar for horizontal tabs on tablet */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Remove default details marker */
  .service-accordion summary::-webkit-details-marker {
    display: none;
  }
  .service-accordion summary::marker {
    display: none;
    content: '';
  }
</style>
