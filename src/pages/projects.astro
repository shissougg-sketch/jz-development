---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
import CTASection from '../components/CTASection.astro';
import ProjectGallery from '../components/ProjectGallery.astro';

interface Project {
  id: number;
  title: string;
  category: string;
  tags: string[];
  beforeImage?: string;
  afterImage?: string;
  duringImages?: string[];
}

const categories = [
  { id: 'all', label: 'All Projects' },
  { id: 'exterior', label: 'Exterior' },
  { id: 'interior', label: 'Interior' },
  { id: 'masonry', label: 'Masonry' },
  { id: 'concrete', label: 'Concrete' },
  { id: 'epoxy', label: 'Epoxy' },
  { id: 'new-construction', label: 'New Construction' }
];

const projects: Project[] = [
  // Basements
  {
    id: 1,
    title: "Basement Renovation",
    category: "basements",
    tags: ["interior"],
    beforeImage: "/images/projects/basements/basement-before-02-01.webp",
    afterImage: "/images/projects/basements/basement-after-02-02.webp"
  },
  {
    id: 2,
    title: "Cellar Bilco Door",
    category: "basements",
    tags: ["interior", "exterior"],
    duringImages: [
      "/images/projects/basements/cellar-belco-01-01.webp",
      "/images/projects/basements/cellar-belco-01-02.webp",
      "/images/projects/basements/cellar-belco-01-03.webp"
    ]
  },
  // Concrete
  {
    id: 3,
    title: "Cellar Concrete Work",
    category: "concrete",
    tags: ["concrete", "interior"],
    beforeImage: "/images/projects/concrete/cellar-before-01-01.webp",
    afterImage: "/images/projects/concrete/cellar-after-01-03.webp",
    duringImages: ["/images/projects/concrete/cellar-01-02.webp"]
  },
  {
    id: 4,
    title: "Asphalt Repair",
    category: "concrete",
    tags: ["concrete", "exterior"],
    beforeImage: "/images/projects/concrete/asphalt-before-02-01.webp",
    afterImage: "/images/projects/concrete/ashphalt-after-02-02.webp"
  },
  {
    id: 5,
    title: "Garage Floor",
    category: "concrete",
    tags: ["concrete", "interior"],
    beforeImage: "/images/projects/concrete/garage-before-03-01.webp",
    afterImage: "/images/projects/concrete/garage-after-03-03.webp",
    duringImages: ["/images/projects/concrete/garage-03-02.webp"]
  },
  {
    id: 6,
    title: "Bollards Installation",
    category: "concrete",
    tags: ["concrete", "exterior"],
    beforeImage: "/images/projects/concrete/ballards-before-04-01.webp",
    afterImage: "/images/projects/concrete/ballards-after-04-03.webp",
    duringImages: ["/images/projects/concrete/ballards-04-02.webp"]
  },
  {
    id: 7,
    title: "Extension Foundation",
    category: "concrete",
    tags: ["concrete", "new-construction"],
    beforeImage: "/images/projects/concrete/extention-before-05-01.webp",
    afterImage: "/images/projects/concrete/extention-after-05-02.webp"
  },
  // Epoxy
  {
    id: 8,
    title: "Epoxy Floor Coating",
    category: "epoxy",
    tags: ["epoxy", "interior"],
    beforeImage: "/images/projects/epoxy/epoxy-before-01-01.webp",
    afterImage: "/images/projects/epoxy/epoxy-after-01-02.webp"
  },
  // Exteriors
  {
    id: 9,
    title: "Fire Pit Installation",
    category: "exteriors",
    tags: ["exterior", "masonry"],
    beforeImage: "/images/projects/exteriors/firepit-before-01-01.webp",
    afterImage: "/images/projects/exteriors/firepit-after-01-02.webp"
  },
  {
    id: 10,
    title: "Pool Pavers",
    category: "exteriors",
    tags: ["exterior", "masonry"],
    beforeImage: "/images/projects/exteriors/poolpavers-before-02-01.webp",
    afterImage: "/images/projects/exteriors/poolpavers-after-02-03.webp",
    duringImages: ["/images/projects/exteriors/poolpavers-02-02.webp"]
  },
  // Masonry
  {
    id: 11,
    title: "Stoop Renovation",
    category: "masonry",
    tags: ["masonry", "exterior"],
    beforeImage: "/images/projects/masonry/stoop-before-01-01.webp",
    afterImage: "/images/projects/masonry/stoop-after-01-03.webp",
    duringImages: ["/images/projects/masonry/stoop-01-02.webp"]
  },
  // New Construction
  {
    id: 12,
    title: "New Construction",
    category: "new-construction",
    tags: ["new-construction", "exterior"],
    beforeImage: "/images/projects/new-construction/new-before-01-01.webp",
    afterImage: "/images/projects/new-construction/new-after-01-03.webp",
    duringImages: ["/images/projects/new-construction/new-01-02.webp"]
  }
];
---

<BaseLayout
  title="Projects"
  description="Browse our portfolio of completed construction projects on Long Island. View our masonry, renovation, kitchen, bathroom, epoxy flooring, and new construction work."
>
  <Header slot="header" />

  <!-- Hero -->
  <Hero
    variant="page"
    title="Our Projects"
    subtitle="Browse our portfolio and see the quality craftsmanship we bring to every project."
  />

  <!-- Gallery Section -->
  <section class="section bg-white">
    <div class="container mx-auto px-4">
      <!-- Filter Buttons -->
      <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-10">
        {categories.map((cat) => (
          <button
            class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all border-2 border-[var(--slate-blue)]"
            data-filter={cat.id}
          >
            {cat.label}
          </button>
        ))}
      </div>

      <!-- Projects Grid -->
      <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {projects.map((project) => (
          <div
            class="project-item"
            data-categories={project.tags.join(',')}
          >
            <ProjectGallery
              title={project.title}
              category={project.category}
              beforeImage={project.beforeImage}
              afterImage={project.afterImage}
              duringImages={project.duringImages}
            />
          </div>
        ))}
      </div>

      <!-- No Results Message -->
      <div id="no-results" class="hidden text-center py-12">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="text-gray-500">No projects found in this category.</p>
        <button id="show-all-btn" class="mt-4 text-[var(--slate-blue)] font-medium hover:underline">
          Show all projects
        </button>
      </div>

    </div>
  </section>

  <!-- CTA -->
  <CTASection
    title="Have a Project in Mind?"
    description="Contact us to discuss your project and get a free estimate. We'd love to add your project to our portfolio!"
  />

  <Footer slot="footer" />
</BaseLayout>

<script>
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectItems = document.querySelectorAll('.project-item');
  const noResults = document.getElementById('no-results');
  const showAllBtn = document.getElementById('show-all-btn');

  function setActiveFilter(activeFilter: string) {
    // Update button styles
    filterButtons.forEach((btn) => {
      const filter = btn.getAttribute('data-filter');
      if (filter === activeFilter) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });

    // Filter projects
    let visibleCount = 0;
    projectItems.forEach((item) => {
      const categories = item.getAttribute('data-categories')?.split(',') || [];
      const shouldShow = activeFilter === 'all' || categories.includes(activeFilter);

      if (shouldShow) {
        item.classList.remove('hidden');
        visibleCount++;
      } else {
        item.classList.add('hidden');
      }
    });

    // Show/hide no results message
    if (noResults) {
      if (visibleCount === 0) {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
      }
    }
  }

  // Initialize with "all" selected
  setActiveFilter('all');

  // Add click handlers
  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter');
      if (filter) {
        setActiveFilter(filter);
      }
    });
  });

  // Show all button handler
  showAllBtn?.addEventListener('click', () => {
    setActiveFilter('all');
  });
</script>

<style>
  .filter-btn {
    background-color: transparent;
    color: var(--slate-blue);
  }

  .filter-btn:hover,
  .filter-btn.active {
    background-color: var(--slate-blue);
    color: white;
  }
</style>
